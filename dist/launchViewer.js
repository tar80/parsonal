var t,e,r,n;Array.prototype.indexOf||(Array.prototype.indexOf=function(t,e){var r;if(null==this)throw new Error('Array.indexOf: "this" is null or not defined');var n=Object(this),i=n.length>>>0;if(0===i)return-1;var o=null!=e?e:0;if(Math.abs(o)===Infinity&&(o=0),o>=i)return-1;for(r=Math.max(o>=0?o:i-Math.abs(o),0);r<i;){if(r in n&&n[r]===t)return r;r++}return-1}),Object.keys||(Object.keys=(t=Object.prototype.hasOwnProperty,e=!{toString:null}.propertyIsEnumerable("toString"),n=(r=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"]).length,function(i){if("function"!=typeof i&&("object"!=typeof i||null==i))throw new Error("Object.keys: called on non-object");var o,u,a=[];for(o in i)t.call(i,o)&&a.push(o);if(e)for(u=0;u<n;u++)t.call(i,r[u])&&a.push(r[u]);return a}));var i,validArgs=function(){for(var t=[],e=PPx.Arguments;!e.atEnd();e.moveNext())t.push(e.value);return t},safeArgs=function(){for(var t=[],e=validArgs(),r=0,n=arguments.length;r<n;r++)t.push(_valueConverter(r<0||arguments.length<=r?undefined:arguments[r],e[r]));return t},_valueConverter=function(t,e){if(null==e||""===e)return null!=t?t:undefined;switch(typeof t){case"number":var r=Number(e);return Number.isNaN(r)?t:r;case"boolean":return null!=e&&"false"!==e&&"0"!==e;default:return e}},o={normal:0,readonly:1,hidden:2,system:4,volume:8,directory:16,archive:32,temporary:256,sparse:512,alias:1024,compressed:2048,offline:4096,noindex:8192},u=PPx.CreateObject("Scripting.FileSystemObject"),isEmptyStr=function(t){return""===t},isEmptyObj=function(t){if(t===undefined)return!1;if(null===t)return!0;for(var e in t)return!1;return!0};String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/,"")}),Array.prototype.removeEmpty||(Array.prototype.removeEmpty=function(){for(var t=[],e=0,r=this.length;e<r;e++){var n=this[e];null==n||""===n||n instanceof Array&&0===n.length||n instanceof Object&&isEmptyObj(n)||t.push(n)}return t}),i=PPx.Extract("%*getcust(S_ppm#global:git)"),isEmptyStr(i);var _setStdin=function(t,e){return t?'-io:string,"'+t+'"':e?'-io:send,"'+e.join("%bl")+'"':""},runStdout=function(t){var e=t.cmdline,r=t.wd,n=t.extract,i=void 0!==n&&n,o=t.startmsg,u=void 0!==o&&o,a=t.hide,c=void 0!==a&&a,s=t.utf8,f=void 0!==s&&s,l=t.trim,p=void 0!==l&&l,m=t.single,x=t.multi,d=[c?"-noppb -hide":"-min",u?"":"-nostartmsg",r?"-d:"+r:"",f?"-io:utf8":"",_setStdin(m,x)].join(" ");i||(e="%("+e+"%)");var v=PPx.Extract("%OC %*run("+d+" "+e+")"),P=Number(PPx.Extract());return p&&!isEmptyStr(v)&&(v=v.trim()),[P,v]},a=/^(.+)\..+$/,c=/^path\s=\s"?([^"]+)"?$/,shimToPath=function(t){var e=runStdout({cmdline:"where.exe "+t+" 2>nul",startmsg:!1,hide:!0,trim:!0,utf8:!1}),r=e[0],n=e[1];if(0===r&&!isEmptyStr(n)){if(n.indexOf("\\shims\\")){var i=n.replace(a,"$1.shim");if(u.FileExists(i)){var o=PPx.Extract("%*insertValue("+i+")");isEmptyStr(o)||(n=o.replace(c,"$1"))}}return[0,n]}return[-1,t]},registPath=function(t,e){var r=PPx.Extract("%g'"+e+"'");if(!isEmptyStr(r))return[-1,r];var n=shimToPath(e),i=n[0],o=n[1];return PPx.Execute("*set "+e.toUpperCase()+"="+o),[i,o]},ppvCmdline=function(t){if(/^.+\.txt$/.test(t)){var e=runStdout({cmdline:'"'+registPath(!1,"nkf")+'" -g "'+t+'"',hide:!0,trim:!0,utf8:!1}),r=e[0],n=e[1];if(0===r)switch(n){case"UTF-8":return'-utf8 "'+t+'"';case"UTF-16":return'-utf16 "'+t+'"'}}return'"'+t+'"'},s={doc:[".txt",".ini","log",".cfg",".html",".md",".json",".yml",".yaml",".toml",".js",".ts",".vbs",".vim",".lua"],image:[".jpg",".jpeg",".bmp",".png",".gif",".vch",".edg",".webp",".tif",".tiff"],movie:[".3gp",".avi",".mp4",".mpg",".qt",".ebml",".webm"]},f="launchPPv",l="Z",p="3",main=function(){var t=PPx.Extract(".%t").toLowerCase(),e=safeArgs(getExtentions(t),""),r=e[0],n=e[1],i=PPx.WindowIDName==="C_"+n;if(!(PPx.DirectoryType>=63)||"MOVIE"!==r&&!PPx.Execute('%"'+f+'"%Q"書庫内ファイルを開きます"'))if(r){var o=PPx.Extract('%*name(CN,"%FCN")'),u=getParent()+"\\"+o;if("MOVIE"===r)PPx.Execute('%Obd *ppb -c mpv.exe "'+u+'" --framedrop=vo --geometry=%*windowrect(%N.,w)x%*windowrect(%N.,h)+%*windowrect(%N.,l)+%*windowrect(%N.,t) --loop=no "'+u+'"');else{setupPPv(i,f),PPx.Execute("*setcust X_vpos="+p),PPx.Execute("%Oi *ppv -bootid:"+l+" "+ppvCmdline(u));var a=i?"a:d-":"path:,"+s[r];PPx.Execute("*maskentry -temp "+a),PPx.Execute("*jumppath -update -entry:"+o)}}else PPx.Execute('%K"@^i"%:*wait 0,1%:*focus %G"TEIF|"%:%k"^q v"')},getExtentions=function(t){for(var e=0,r=Object.keys(s);e<r.length;e++){var n=r[e];if(~s[n].indexOf(t))return n}},getParent=function(){return o.alias&PPx.Entry.Attributes?"%*linkedpath(%FD)":"%FD"},setupPPv=function(t,e){var r=t?"B100000000":"B000000000",n=e+",KV_main:CLOSEEVENT";PPx.Execute("*setcust X_win:V="+r),PPx.Execute("*linecust "+n+",*linecust "+n+",%%:*setcust X_vpos=%*getcust(X_vpos)%%:*execute C,%(*maskentry%%:*jumppath -update -entry:%%R%)")};main();
