function _extends(){return _extends=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)({}).hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},_extends.apply(null,arguments)}var t,e,r,n;Array.prototype.indexOf||(Array.prototype.indexOf=function(t,e){var r;if(null==this)throw new Error('Array.indexOf: "this" is null or not defined');var n=Object(this),i=n.length>>>0;if(0===i)return-1;var o=null!=e?e:0;if(Math.abs(o)===Infinity&&(o=0),o>=i)return-1;for(r=Math.max(o>=0?o:i-Math.abs(o),0);r<i;){if(r in n&&n[r]===t)return r;r++}return-1}),Object.keys||(Object.keys=(t=Object.prototype.hasOwnProperty,e=!{toString:null}.propertyIsEnumerable("toString"),n=(r=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"]).length,function(i){if("function"!=typeof i&&("object"!=typeof i||null==i))throw new Error("Object.keys: called on non-object");var o,u,a=[];for(o in i)t.call(i,o)&&a.push(o);if(e)for(u=0;u<n;u++)t.call(i,r[u])&&a.push(r[u]);return a}));var validArgs=function(){for(var t=[],e=PPx.Arguments;!e.atEnd();e.moveNext())t.push(e.value);return t},safeArgs=function(){for(var t=[],e=validArgs(),r=0,n=arguments.length;r<n;r++)t.push(_valueConverter(r<0||arguments.length<=r?undefined:arguments[r],e[r]));return t},_valueConverter=function(t,e){if(null==e||""===e)return null!=t?t:undefined;switch(typeof t){case"number":var r=Number(e);return isNaN(r)?t:r;case"boolean":return null!=e&&"false"!==e&&"0"!==e;default:return e}},i={normal:0,readonly:1,hidden:2,system:4,volume:8,directory:16,archive:32,temporary:256,sparse:512,alias:1024,compressed:2048,offline:4096,noindex:8192};!function(){if("object"!=typeof JSON){JSON={};var t,e,r,n,i=/^[\],:{}\s]*$/,o=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,u=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,a=/(?:^|:|,)(?:\s*\[)+/g,c=/[\\"\u0000-\u001f\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,s=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":"Invalid Date"}),"function"!=typeof JSON.stringify&&(r={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},JSON.stringify=function(r,i,o){var u;if(t="",e="","number"==typeof o)for(u=0;u<o;u+=1)e+=" ";else"string"==typeof o&&(e=o);if(n=i,i&&"function"!=typeof i&&("object"!=typeof i||"number"!=typeof i.length))throw new Error("JSON.stringify");return str("",{"":r})}),"function"!=typeof JSON.parse&&(JSON.parse=function(t,e){var r;function walk(t,r){var n,i,o=t[r];if(o&&"object"==typeof o)for(n in o)Object.prototype.hasOwnProperty.call(o,n)&&((i=walk(o,n))!==undefined?o[n]=i:delete o[n]);return e.call(t,r,o)}if(t=String(t),s.lastIndex=0,s.test(t)&&(t=t.replace(s,(function(t){return"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)}))),i.test(t.replace(o,"@").replace(u,"]").replace(a,"")))return r=Function("return ("+t+")")(),"function"==typeof e?walk({"":r},""):r;throw new Error("JSON.parse")})}function f(t){return t<10?"0"+t:t}function quote(t){return c.lastIndex=0,c.test(t)?'"'+t.replace(c,(function(t){var e=r[t];return"string"==typeof e?e:"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)}))+'"':'"'+t+'"'}function str(r,i){var o,u,a,c,s,p=t,l=i[r];switch(l&&"object"==typeof l&&"function"==typeof l.toJSON&&(l=l.toJSON(r)),"function"==typeof n&&(l=n.call(i,r,l)),typeof l){case"string":return quote(l);case"number":return isFinite(l)?String(l):"null";case"boolean":return String(l);case"object":if(!l)return"null";if(t+=e,s=[],"[object Array]"===Object.prototype.toString.apply(l)){for(c=l.length,o=0;o<c;o+=1)s[o]=str(String(o),l)||"null";return a=0===s.length?"[]":t?"[\n"+t+s.join(",\n"+t)+"\n"+p+"]":"["+s.join(",")+"]",t=p,a}if(n&&"object"==typeof n)for(c=n.length,o=0;o<c;o+=1)"string"==typeof n[o]&&(a=str(u=String(n[o]),l))&&s.push(quote(u)+(t?": ":":")+a);else for(u in l)Object.prototype.hasOwnProperty.call(l,u)&&(a=str(u,l))&&s.push(quote(u)+(t?": ":":")+a);return a=0===s.length?"{}":t?"{\n"+t+s.join(",\n"+t)+"\n"+p+"}":"{"+s.join(",")+"}",t=p,a}return"null"}}();var o,isEmptyStr=function(t){return""===t},isEmptyObj=function(t){if(t===undefined)return!1;if(null===t)return!0;for(var e in t)return!1;return!0},u=PPx.CreateObject("Scripting.FileSystemObject"),parseSource=function(t,e){var r=JSON.parse(e.replace(/\\/g,"\\\\"));return r.path="remote"===r.location?PPx.Extract("%*getcust(S_ppm#global:home)")+"\\repo\\"+t:r.path,_extends({name:t},r)},expandSource=function(t){var e=PPx.Extract("%*getcust(S_ppm#sources:"+t+")");return isEmptyStr(e)?undefined:parseSource(t,e)};PPx.Extract('%sgu"ppmcache"'),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/,"")}),Array.prototype.removeEmpty||(Array.prototype.removeEmpty=function(){for(var t=[],e=0,r=this.length;e<r;e++){var n=this[e];null==n||""===n||n instanceof Array&&0===n.length||n instanceof Object&&isEmptyObj(n)||t.push(n)}return t}),o=PPx.Extract("%*getcust(S_ppm#global:git)"),isEmptyStr(o);var _setStdin=function(t,e){return t?'-io:string,"'+t+'"':e?'-io:send,"'+e.join("%bl")+'"':""},runStdout=function(t){var e=t.cmdline,r=t.wd,n=t.extract,i=void 0!==n&&n,o=t.startmsg,u=void 0!==o&&o,a=t.hide,c=void 0!==a&&a,s=t.utf8,p=void 0!==s&&s,l=t.trim,g=void 0!==l&&l,d=t.single,x=t.multi,h=[c?"-noppb -hide":"-min",u?"":"-nostartmsg",r?"-d:"+r:"",p?"-io:utf8":"",_setStdin(d,x)].join(" ");i||(e="%("+e+"%)");var m=PPx.Extract("%OC %*run("+h+" "+e+")"),y=Number(PPx.Extract());return g&&!isEmptyStr(m)&&(m=m.trim()),[y,m]},a=/^(.+)\..+$/,c=/^path\s=\s"?([^"]+)"?$/,shimToPath=function(t){var e=runStdout({cmdline:"where.exe "+t+" 2>nul",startmsg:!1,hide:!0,trim:!0,utf8:!1}),r=e[0],n=e[1];if(0===r&&!isEmptyStr(n)){if(n.indexOf("\\shims\\")){var i=n.replace(a,"$1.shim");if(u.FileExists(i)){var o=PPx.Extract("%*insertValue("+i+")");isEmptyStr(o)||(n=o.replace(c,"$1"))}}return[0,n]}return[-1,t]},registPath=function(t,e){var r=PPx.Extract("%g'"+e+"'");if(!isEmptyStr(r))return[-1,r];var n=shimToPath(e),i=n[0],o=n[1];return PPx.Execute("*set "+e.toUpperCase()+"="+o),[i,o]},ppvCmdline=function(t){if(/^.+\.txt$/.test(t)){var e=runStdout({cmdline:'"'+registPath(!1,"nkf")+'" -g "'+t+'"',hide:!0,trim:!0,utf8:!1}),r=e[0],n=e[1];if(0===r)switch(n){case"UTF-8":return'-utf8 "'+t+'"';case"UTF-16":return'-utf16 "'+t+'"'}}return'"'+t+'"'},s="",p={doc:[".txt",".ini","log",".cfg",".html",".md",".json",".yml",".yaml",".toml",".js",".ts",".vbs",".vim",".lua"],image:[".jpg",".jpeg",".bmp",".png",".gif",".vch",".edg",".webp",".tif",".tiff"],movie:[".3gp",".avi",".mp4",".mpg",".qt",".ebml",".webm"]},l="launchViewer",g="Z",d="3",x="workerPPv.stay.js",main=function(){var t=PPx.Extract(".%t").toLowerCase(),e=safeArgs(getExtentions(t),""),r=e[0],n=e[1];if(!(PPx.DirectoryType>=63)||"movie"!==r&&!PPx.Execute('%"'+l+'"%Q"書庫内ファイルを開きます"'))if(r){var i=PPx.Extract('%*name(CN,"%FCN")'),o=getParent()+"\\"+i;"movie"===r?startMpv(o):startPPv(r,n,o,i)}else PPx.Execute('%K"@^i"%:*wait 0,1%:*focus %G"TEIF|"%:%k"^q v"')},getExtentions=function(t){for(var e=0,r=Object.keys(p);e<r.length;e++){var n=r[e];if(~p[n].indexOf(t))return n}},getParent=function(){return i.alias&PPx.Entry.Attributes?'%*name(D,"%*linkedpath(%FDC)")':"%FD"},startMpv=function(t){PPx.Execute('%Obd *ppb -c mpv.exe "'+t+'" --framedrop=vo --geometry=%*windowrect(%N.,w)x%*windowrect(%N.,h)+%*windowrect(%N.,l)+%*windowrect(%N.,t) --loop=no "'+t+'"')},startPPv=function(t,e,r,n){var i,o,u=null==(i=expandSource("ppm-view"))?void 0:i.path;if(u||PPx.linemessage("[ERROR] ppm-viewのパスを取得できませんでした"),PPx.Extract("%n")==="C"+e){o="a:d-";var a="-nostartmsg -wait:idle -max";PPx.Execute("*launch "+a+" %0ppvw.exe -bootid:"+g+" "+ppvCmdline(r))}else{o="path:,"+p[t];var c=PPx.Extract("%*getcust(_WinPos:V"+g+")"),h=PPx.Extract("%*getcust(X_vpos)"),m="-nostartmsg -wait:idle -noppb -hide",y=["*script "+u+"\\dist\\"+x+',0,,,"'+c+'",'+s,"*setcust X_vpos="+h];PPx.Execute("*setcust X_vpos="+d),PPx.Execute("*launch "+m+" %0ppvw.exe -bootid:"+g+" -k %("+y.join("%:")+'%)%%:%%v"'+r+'"')}var v="*linecust "+l+",KV_main:CLOSEEVENT";PPx.Execute(v+","+v+",%%:%(*execute C,*maskentry%%:*jumppath -update -entry:%%R%)"),PPx.Execute("*maskentry -temp "+o),PPx.Execute("*jumppath -update -entry:"+n)};main();
