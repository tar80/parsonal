var validArgs=function(){for(var e=[],t=PPx.Arguments;!t.atEnd();t.moveNext())e.push(t.value);return e},safeArgs=function(){for(var e=[],t=validArgs(),r=0,n=arguments.length;r<n;r++)e.push(_valueConverter(r<0||arguments.length<=r?undefined:arguments[r],t[r]));return e},_valueConverter=function(e,t){if(null==t||""===t)return null!=e?e:undefined;switch(typeof e){case"number":var r=Number(t);return isNaN(r)?e:r;case"boolean":return null!=t&&"false"!==t&&"0"!==t;default:return t}},e=PPx.CreateObject("Scripting.FileSystemObject"),t={ppmName:"ppx-plugin-manager",ppmVersion:.95,language:"ja",encode:"utf16le",nlcode:"\r\n",nltype:"crlf",ppmID:"P",ppmSubID:"Q"},r={TypeToCode:{crlf:"\r\n",cr:"\r",lf:"\n"},CodeToType:{"\r\n":"crlf","\r":"cr","\n":"lf"},Ppx:{lf:"%%bl",cr:"%%br",crlf:"%%bn",unix:"%%bl",mac:"%%br",dos:"%%bn","\n":"%%bl","\r":"%%br","\r\n":"%%bn"},Ascii:{lf:"10",cr:"13",crlf:"-1",unix:"10",mac:"13",dos:"-1","\n":"10","\r":"13","\r\n":"-1"}},isCV8=function(){return"ClearScriptV8"===PPx.ScriptEngineName},_exec=function(e,t){try{var r;return[!1,null!=(r=t())?r:""]}catch(n){return[!0,""]}finally{e.Close()}},read=function(t){var r=t.path,n=t.enc,i=void 0===n?"utf8":n;if(!e.FileExists(r))return[!0,r+" not found"];var a=e.GetFile(r);if(0===a.Size)return[!0,r+" has no data"];var l=!1,u="";if("utf8"===i){var o=PPx.CreateObject("ADODB.Stream"),c=_exec(o,(function(){return o.Open(),o.Charset="UTF-8",o.LoadFromFile(r),o.ReadText(-1)}));l=c[0],u=c[1]}else{var s="utf16le"===i?-1:0,f=a.OpenAsTextStream(1,s),d=_exec(f,(function(){return f.ReadAll()}));l=d[0],u=d[1]}return l?[!0,"Unable to read "+r]:[!1,u]},writeLines=function(n){var i=n.path,a=n.data,l=n.enc,u=void 0===l?"utf8":l,o=n.append,c=void 0!==o&&o,s=n.overwrite,f=void 0!==s&&s,d=n.linefeed,p=void 0===d?t.nlcode:d;if(!f&&!c&&e.FileExists(i))return[!0,i+" already exists"];var P,x=e.GetParentFolderName(i);if(e.FolderExists(x)||PPx.Execute("*makedir "+x),"utf8"===u){if(isCV8()){var m=a.join(p),v=c?"AppendAllText":"WriteAllText";return[!1,NETAPI.System.IO.File[v](i,m)]}var F=f||c?2:1,g=PPx.CreateObject("ADODB.Stream");P=_exec(g,(function(){g.Open(),g.Charset="UTF-8",g.LineSeparator=Number(r.Ascii[p]),c?(g.LoadFromFile(i),g.Position=g.Size,g.SetEOS):g.Position=0,g.WriteText(a.join(p),1),g.SaveToFile(i,F)}))[0]}else{var b=c?8:f?2:1;e.FileExists(i)||PPx.Execute("%Osq *makefile "+i);var E="utf16le"===u?-1:0,h=e.GetFile(i).OpenAsTextStream(b,E);P=_exec(h,(function(){h.Write(a.join(p)+p)}))[0]}return P?[!0,"Could not write to "+i]:[!1,""]},n="%'scoop'\\ghostscript\\current\\gswin64c.exe",i="-dSAFER -dBATCH -dNOPAUSE -sDEVICE=png16m -r400 -dTextAlphaBits=4 -dDownScaleFactor=2",a=99,main=function(){var t=safeArgs(PPx.Extract("%FDC"),a),r=t[0],l=t[1],u=PPx.Extract("%FD"),o=getDirPath(r);if(":PDF"===PPx.GetFileInformation(r)){var c=read({path:r}),s=c[0],f=c[1];if(s)PPx.linemessage("Could not read file");else{var d=pageNumber(f,l);if(0!==d){var p=getFilenames(d),P=[";ListFile",";Base="+o,u].concat(p),x=o+"\\page";if(!e.FileExists(x)){var m=writeLines({path:x,data:P});if(s=m[0],f=m[1],s)return void PPx.linemessage("Failed to write ListFile");PPx.Execute("%On *cd "+o+"%:*ppb -c %("+n+" "+i+" -dFirstPage=1 -dLastPage="+d+' -sOutputFile="%%03d" "'+r+'"%)')}PPx.Execute("*jumppath "+x)}else PPx.linemessage("Could not get page number")}}else PPx.linemessage("Not a PDF file")},getDirPath=function(e){return""+PPx.Extract("%*temp()")+PPx.Extract('%*name(X,"'+e+'")')},pageNumber=function(e,t){var r=/Type\s*\/Page[^s]/g,n=e.match(r);if(!n)return 0;var i=n.length;return t?Math.min(t,i):i},getFilenames=function(e){for(var t=[],r=0;r<e;r++)t.push(("00"+(r+1)).slice(-3));return t};main();
