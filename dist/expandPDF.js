var e=PPx.CreateObject("Scripting.FileSystemObject"),t="\r\n",r={TypeToCode:{crlf:"\r\n",cr:"\r",lf:"\n"},CodeToType:{"\r\n":"crlf","\r":"cr","\n":"lf"},Ppx:{lf:"%%bl",cr:"%%br",crlf:"%%bn",unix:"%%bl",mac:"%%br",dos:"%%bn","\n":"%%bl","\r":"%%br","\r\n":"%%bn"},Ascii:{lf:"10",cr:"13",crlf:"-1",unix:"10",mac:"13",dos:"-1","\n":"10","\r":"13","\r\n":"-1"}},n=function(e,t){try{var r;return[!1,null!=(r=t())?r:""]}catch(n){return[!0,""]}finally{e.Close()}},i=function(i){var a=i.path,l=i.data,o=i.enc,s=void 0===o?"utf8":o,c=i.append,u=void 0!==c&&c,f=i.overwrite,P=void 0!==f&&f,x=i.linefeed,d=void 0===x?t:x;if(!P&&!u&&e.FileExists(a))return[!0,a+" already exists"];var p,v=e.GetParentFolderName(a);if(e.FolderExists(v)||PPx.Execute("*makedir "+v),"utf8"===s){if("ClearScriptV8"===PPx.ScriptEngineName){var m=l.join(d),F=u?"AppendAllText":"WriteAllText";return[!1,NETAPI.System.IO.File[F](a,m)]}var E=P||u?2:1,g=PPx.CreateObject("ADODB.Stream");p=n(g,(function(){g.Open(),g.Charset="UTF-8",g.LineSeparator=Number(r.Ascii[d]),u?(g.LoadFromFile(a),g.Position=g.Size,g.SetEOS):g.Position=0,g.WriteText(l.join(d),1),g.SaveToFile(a,E)}))[0]}else{var S=u?8:P?2:1;e.FileExists(a)||PPx.Execute("%Osq *makefile "+a);var b="utf16le"===s?-1:0,h=e.GetFile(a).OpenAsTextStream(S,b);p=n(h,(function(){h.Write(l.join(d)+d)}))[0]}return p?[!0,"Could not write to "+a]:[!1,""]},a=function(e){void 0===e&&(e=PPx.Arguments);for(var t=[],r=0,n=e.length;r<n;r++)t[r]=e.Item(r);return{path:t[0],last:t[1]}},l=function(e){return""+PPx.Extract("%*temp()")+PPx.Extract('%*name(X,"'+e+'")')},o=function(e,t){var r=e.match(/Type\s*\/Page[^s]/g);if(!r)return 0;var n=r.length;return t?Math.min(t,n):n},s=function(e){for(var t=[],r=0;r<e;r++)t.push(("00"+(r+1)).slice(-3));return t};!function(){var t=a(),r=PPx.Extract("%FD"),c=t.path||PPx.Extract("%FDC"),u=t.last||99,f=l(c);if(":PDF"===PPx.GetFileInformation(c)){var P=function(t){var r=t.path,i=t.enc,a=void 0===i?"utf8":i;if(!e.FileExists(r))return[!0,r+" not found"];var l=e.GetFile(r);if(0===l.Size)return[!0,r+" has no data"];var o=!1,s="";if("utf8"===a){var c=PPx.CreateObject("ADODB.Stream"),u=n(c,(function(){return c.Open(),c.Charset="UTF-8",c.LoadFromFile(r),c.ReadText(-1)}));o=u[0],s=u[1]}else{var f="utf16le"===a?-1:0,P=l.OpenAsTextStream(1,f),x=n(P,(function(){return P.ReadAll()}));o=x[0],s=x[1]}return o?[!0,"Unable to read "+r]:[!1,s]}({path:c}),x=P[0],d=P[1];if(x)PPx.linemessage("Could not read file");else{var p=o(d,u);if(0!==p){var v=s(p),m=[";ListFile",";Base="+f,r].concat(v),F=f+"\\page";if(!e.FileExists(F)){var E=i({path:F,data:m});if(x=E[0],d=E[1],x)return void PPx.linemessage("Failed to write ListFile");PPx.Execute("%On *cd "+f+"%:*ppb -c %(gswin64c.exe -dSAFER -dBATCH -dNOPAUSE -sDEVICE=png16m -r400 -dTextAlphaBits=4 -dDownScaleFactor=2 -dFirstPage=1 -dLastPage="+p+' -sOutputFile="%%03d" "'+c+'"%)')}PPx.Execute("*jumppath "+F)}else PPx.linemessage("Could not get page number")}}else PPx.linemessage("Not a PDF file")}();
