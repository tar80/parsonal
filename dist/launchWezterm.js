var validArgs=function(){for(var e=[],t=PPx.Arguments;!t.atEnd();t.moveNext())e.push(t.value);return e},safeArgs=function(){for(var e=[],t=validArgs(),r=0,n=arguments.length;r<n;r++)e.push(_valueConverter(r<0||arguments.length<=r?undefined:arguments[r],t[r]));return e},_valueConverter=function(e,t){if(null==t||""===t)return null!=e?e:undefined;switch(typeof e){case"number":var r=Number(t);return isNaN(r)?e:r;case"boolean":return null!=t&&"false"!==t&&"0"!==t;default:return t}},isEmptyStr=function(e){return""===e},pathSelf=function(){var e,t,r=PPx.ScriptName;return~r.indexOf("\\")?(e=extractFileName(r),t=PPx.Extract("%*name(DKN,"+r+")")):(e=r,t=PPx.Extract("%FDN")),{scriptName:e,parentDir:t.replace(/\\$/,"")}},extractFileName=function(e,t){return void 0===t&&(t="\\"),"\\"!==t&&"/"!==t&&(t="\\"),e.slice(e.lastIndexOf(t)+1)},e=6e3,t=500,main=function(){var r=safeArgs(undefined,e,"W"),n=r[0],a=r[1],u=r[2];if(null==n){var i=pathSelf(),c=i.scriptName,P=i.parentDir;PPx.Execute("*script "+P+'\\errors.js",arg,'+c),PPx.Quit(-1)}var s=isEmptyStr(PPx.Extract("%NB"+u))?"*launch -noppb -hide -nostartmsg wezterm start":"*execute B"+u+",wezterm cli spawn >nul",x=/^.+\.exe$/i.test(n)?n:PPx.Extract(n);~x.indexOf(":")||(PPx.Echo("[ERROR] Process name must be a full-path or alias"),PPx.Quit(-1));var f=processRunning(x);if(PPx.result=f,a>0&&!f){PPx.Execute(s+" "+x);for(var o=0,l=0,m=0,d=t;;){if(o+=t,PPx.Execute("*wait "+(d-Math.floor(d/10))+",2"),o>=a){PPx.linemessage('!"Abort. Waiting time exceeded');break}if(l=(new Date).getTime(),f=processRunning(x),m=(new Date).getTime(),f)break;d=t-(m-l)}}PPx.Execute("*focus #%*findwindowclass(org.wezfurlong.wezterm)")},processRunning=function(e){var t=PPx.Extract("%*useapps("+e+")");return!isEmptyStr(t)};main();
