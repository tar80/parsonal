var e,t,r,n;Array.prototype.indexOf||(Array.prototype.indexOf=function(e,t){var r;if(null==this)throw new Error('Array.indexOf: "this" is null or not defined');var n=Object(this),i=n.length>>>0;if(0===i)return-1;var c=null!=t?t:0;if(Math.abs(c)===Infinity&&(c=0),c>=i)return-1;for(r=Math.max(c>=0?c:i-Math.abs(c),0);r<i;){if(r in n&&n[r]===e)return r;r++}return-1}),Object.keys||(Object.keys=(e=Object.prototype.hasOwnProperty,t=!{toString:null}.propertyIsEnumerable("toString"),n=(r=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"]).length,function(i){if("function"!=typeof i&&("object"!=typeof i||null==i))throw new Error("Object.keys: called on non-object");var c,o,u=[];for(c in i)e.call(i,c)&&u.push(c);if(t)for(o=0;o<n;o++)e.call(i,r[o])&&u.push(r[o]);return u}));var i={ppmName:"ppx-plugin-manager",ppmVersion:.95,language:"ja",encode:"utf16le",nlcode:"\r\n",nltype:"crlf",ppmID:"P",ppmSubID:"Q"},tmp=function(){var e=PPx.Extract('%*extract(C,"%%*temp()")');return{dir:e,file:e+"_ppmtemp",lf:e+"_temp.xlf",stdout:e+"_stdout",stderr:e+"_stderr",ppmDir:function(){var e=PPx.Extract("%'temp'%\\ppm");return PPx.Execute("*makedir "+e),e}}},isEmptyStr=function(e){return""===e},c=PPx.CreateObject("Scripting.FileSystemObject"),o={TypeToCode:{crlf:"\r\n",cr:"\r",lf:"\n"},CodeToType:{"\r\n":"crlf","\r":"cr","\n":"lf"},Ppx:{lf:"%%bl",cr:"%%br",crlf:"%%bn",unix:"%%bl",mac:"%%br",dos:"%%bn","\n":"%%bl","\r":"%%br","\r\n":"%%bn"},Ascii:{lf:"10",cr:"13",crlf:"-1",unix:"10",mac:"13",dos:"-1","\n":"10","\r":"13","\r\n":"-1"}},isCV8=function(){return"ClearScriptV8"===PPx.ScriptEngineName},windowID=function(){var e=PPx.Extract("%n"),t=e.replace(/^([CVB])([^_]+)$/,"$1_$2");return{id:e,uid:t}},_exec=function(e,t){try{var r;return[!1,null!=(r=t())?r:""]}catch(n){return[!0,""]}finally{e.Close()}},writeLines=function(e){var t=e.path,r=e.data,n=e.enc,u=void 0===n?"utf8":n,p=e.append,a=void 0!==p&&p,l=e.overwrite,s=void 0!==l&&l,P=e.linefeed,f=void 0===P?i.nlcode:P;if(!s&&!a&&c.FileExists(t))return[!0,t+" already exists"];var x,d=c.GetParentFolderName(t);if(c.FolderExists(d)||PPx.Execute("*makedir "+d),"utf8"===u){if(isCV8()){var v=r.join(f),m=a?"AppendAllText":"WriteAllText";return[!1,NETAPI.System.IO.File[m](t,v)]}var E=s||a?2:1,b=PPx.CreateObject("ADODB.Stream");x=_exec(b,(function(){b.Open(),b.Charset="UTF-8",b.LineSeparator=Number(o.Ascii[f]),a?(b.LoadFromFile(t),b.Position=b.Size,b.SetEOS):b.Position=0,b.WriteText(r.join(f),1),b.SaveToFile(t,E)}))[0]}else{var h=a?8:s?2:1;c.FileExists(t)||PPx.Execute("%Osq *makefile "+t);var y="utf16le"===u?-1:0,O=c.GetFile(t).OpenAsTextStream(h,y);x=_exec(O,(function(){O.Write(r.join(f)+f)}))[0]}return x?[!0,"Could not write to "+t]:[!1,""]},pathSelf=function(){var e,t,r=PPx.ScriptName;return~r.indexOf("\\")?(e=extractFileName(r),t=PPx.Extract("%*name(DKN,"+r+")")):(e=r,t=PPx.Extract("%FDN")),{scriptName:e,parentDir:t.replace(/\\$/,"")}},extractFileName=function(e,t){return void 0===t&&(t="\\"),"\\"!==t&&"/"!==t&&(t="\\"),e.slice(e.lastIndexOf(t)+1)},validArgs=function(){for(var e=[],t=PPx.Arguments;!t.atEnd();t.moveNext())e.push(t.value);return e},safeArgs=function(){for(var e=[],t=validArgs(),r=0,n=arguments.length;r<n;r++)e.push(_valueConverter(r<0||arguments.length<=r?undefined:arguments[r],t[r]));return e},_valueConverter=function(e,t){if(null==t||""===t)return null!=e?e:undefined;switch(typeof e){case"number":var r=Number(t);return Number.isNaN(r)?e:r;case"boolean":return null!=t&&"false"!==t&&"0"!==t;default:return t}},u={MENU:"M_temp",PPE:"PPe",PPE_CLASS:"PPeditW",SEP:"-- ="},p=windowID().uid,main=function(){var e=PPx.Extract("%*findwindowclass("+u.PPE_CLASS+")"),t=sortPPxID(e),r=pathSelf().scriptName;t||(PPx.Echo(r+": "+PPx.Extract("%*errormsg(10022)")),PPx.Quit(-1)),~t.indexOf(p)&&t.splice(t.indexOf(p),1);var n=t.length;if(1===n)PPx.Execute("*selectppx "+t[0]);else if(n>1){var c=tmp().file,o=writeLines({path:c,data:createMenu(n,t,e),enc:"utf16le",linefeed:i.nlcode,overwrite:!0}),a=o[0],l=o[1];a&&(PPx.Echo(r+": "+l),PPx.Quit(-1)),PPx.Execute("*setcust @"+c),PPx.Execute('%k"@down"%:*focus %'+u.MENU),PPx.Execute('*deletecust "'+u.MENU+'"'),PPx.Execute('%K"@LOADCUST"')}},sortPPxID=function(e){var t=safeArgs("")[0],r=/^[BCV#]#?$/;if(isEmptyStr(t)||r.test(t)){var n=PPx.Extract("%*ppxlist(-"+t+")").slice(0,-1).split(",");return n.sort((function(e,t){return e.toLowerCase()<t.toLowerCase()?-1:1})),"0"!==e&&n.push(u.PPE),n}},buildFileName=function(e,t){return PPx.Extract("%*extract("+e+',"'+t+'")').slice(-30)},addSeparator=function(e,t){var r=e.length;return t&&r>0&&e.splice(0,0,u.SEP),t||r>0},createMenu=function(e,t,r){for(var n={ppc:[],ppv:[],ppb:[],ppcust:[],ppe:[]},i=[],c=i[0],o=i[1],p=i[2],a=0;a<e;a++)if(p=(c=t[a]).substring(0,2),o=c.slice(-1),"C_"===p)n.ppc.push("PPc:&"+o+"\\t"+buildFileName(c,"%%FD")+" = "+c);else if("V_"===p)n.ppv.push("PPv:&"+o+"\\t"+buildFileName(c,"%%FC")+" = "+c);else if("B_"===p)n.ppb.push("PPb:&"+o+"\\t<console> = "+c);else if("cs"===p){var l=PPx.Extract('%*findwindowtitle("PPx Customizer")');n.ppcust.push("PPcust:&"+o+"\\t<customizer> = #"+l)}else"PP"===p&&n.ppe.push("PPe:&@\\t<editor>= #"+r);var s=addSeparator(n.ppv,0!==n.ppc.length);return s=addSeparator(n.ppb,s),s=addSeparator(n.ppcust,s),s=addSeparator(n.ppe,s),[u.MENU+"\t= {"].concat(n.ppc,n.ppv,n.ppb,n.ppcust,n.ppe,["}"])};main();
