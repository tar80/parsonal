var e,t,r,n;Array.prototype.indexOf||(Array.prototype.indexOf=function(e,t){var r;if(null==this)throw new Error('Array.indexOf: "this" is null or not defined');var n=Object(this),i=n.length>>>0;if(0===i)return-1;var c=null!=t?t:0;if(Math.abs(c)===Infinity&&(c=0),c>=i)return-1;for(r=Math.max(c>=0?c:i-Math.abs(c),0);r<i;){if(r in n&&n[r]===e)return r;r++}return-1}),Object.keys||(Object.keys=(e=Object.prototype.hasOwnProperty,t=!{toString:null}.propertyIsEnumerable("toString"),n=(r=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"]).length,function(i){if("function"!=typeof i&&("object"!=typeof i||null==i))throw new Error("Object.keys: called on non-object");var c,o,a=[];for(c in i)e.call(i,c)&&a.push(c);if(t)for(o=0;o<n;o++)e.call(i,r[o])&&a.push(r[o]);return a}));var validArgs=function(){for(var e=[],t=PPx.Arguments;!t.atEnd();t.moveNext())e.push(t.value);return e},i={ppmName:"ppx-plugin-manager",ppmVersion:.95,language:"ja",encode:"utf16le",nlcode:"\r\n",nltype:"crlf",ppmID:"P",ppmSubID:"Q"},tmp=function(){var e=PPx.Extract('%*extract(C,"%%*temp()")');return{dir:e,file:e+"_ppmtemp",lf:e+"_temp.xlf",stdout:e+"_stdout",stderr:e+"_stderr",ppmDir:function(){var e=PPx.Extract("%'temp'%\\ppm");return PPx.Execute("*makedir "+e),e}}},isEmptyStr=function(e){return""===e},c=PPx.CreateObject("Scripting.FileSystemObject"),o={TypeToCode:{crlf:"\r\n",cr:"\r",lf:"\n"},CodeToType:{"\r\n":"crlf","\r":"cr","\n":"lf"},Ppx:{lf:"%%bl",cr:"%%br",crlf:"%%bn",unix:"%%bl",mac:"%%br",dos:"%%bn","\n":"%%bl","\r":"%%br","\r\n":"%%bn"},Ascii:{lf:"10",cr:"13",crlf:"-1",unix:"10",mac:"13",dos:"-1","\n":"10","\r":"13","\r\n":"-1"}},isCV8=function(){return"ClearScriptV8"===PPx.ScriptEngineName},windowID=function(){var e=PPx.Extract("%n"),t=e.replace(/^([CVB])([^_]+)$/,"$1_$2");return{id:e,uid:t}},_exec=function(e,t){try{var r;return[!1,null!=(r=t())?r:""]}catch(n){return[!0,""]}finally{e.Close()}},writeLines=function(e){var t=e.path,r=e.data,n=e.enc,a=void 0===n?"utf8":n,p=e.append,u=void 0!==p&&p,s=e.overwrite,l=void 0!==s&&s,f=e.linefeed,P=void 0===f?i.nlcode:f;if(!l&&!u&&c.FileExists(t))return[!0,t+" already exists"];var x,d=c.GetParentFolderName(t);if(c.FolderExists(d)||PPx.Execute("*makedir "+d),"utf8"===a){if(isCV8()){var v=r.join(P),E=u?"AppendAllText":"WriteAllText";return[!1,NETAPI.System.IO.File[E](t,v)]}var m=l||u?2:1,b=PPx.CreateObject("ADODB.Stream");x=_exec(b,(function(){b.Open(),b.Charset="UTF-8",b.LineSeparator=Number(o.Ascii[P]),u?(b.LoadFromFile(t),b.Position=b.Size,b.SetEOS):b.Position=0,b.WriteText(r.join(P),1),b.SaveToFile(t,m)}))[0]}else{var h=u?8:l?2:1;c.FileExists(t)||PPx.Execute("%Osq *makefile "+t);var O="utf16le"===a?-1:0,S=c.GetFile(t).OpenAsTextStream(h,O);x=_exec(S,(function(){S.Write(r.join(P)+P)}))[0]}return x?[!0,"Could not write to "+t]:[!1,""]},pathSelf=function(){var e,t,r=PPx.ScriptName;return~r.indexOf("\\")?(e=extractFileName(r),t=PPx.Extract("%*name(DKN,"+r+")")):(e=r,t=PPx.Extract("%FDN")),{scriptName:e,parentDir:t.replace(/\\$/,"")}},extractFileName=function(e,t){return void 0===t&&(t="\\"),"\\"!==t&&"/"!==t&&(t="\\"),e.slice(e.lastIndexOf(t)+1)},a={MENU:"M_temp",PPE:"PPe",PPE_CLASS:"PPeditW",SEP:"-- ="},p=windowID().uid,main=function(){var e=validArgs(),t=e[0],r=e[1],n=e[2],c=PPx.Extract("%*findwindowclass("+a.PPE_CLASS+")"),o=sortPPxID(c,t),u=pathSelf().scriptName;o||(PPx.Echo(u+": "+PPx.Extract("%*errormsg(10022)")),PPx.Quit(-1)),~o.indexOf(p)&&o.splice(o.indexOf(p),1);var s=o.length;if(1===s){var l=focusPPb(o[0],r,n),f=(l[0],l[1]);PPx.Execute(f)}else if(s>1){var P=tmp().file,x=writeLines({path:P,data:createMenu(s,o,c,r,n),enc:"utf16le",linefeed:i.nlcode,overwrite:!0}),d=x[0],v=x[1];d&&(PPx.Echo(u+": "+v),PPx.Quit(-1)),PPx.Execute("*setcust @"+P),PPx.Execute('%k"@down"%:*execute ,%'+a.MENU),PPx.Execute('*deletecust "'+a.MENU+'"'),PPx.Execute('%K"@LOADCUST"')}},sortPPxID=function(e,t){void 0===t&&(t="");var r=/^[BCV#]#?$/;if(isEmptyStr(t)||r.test(t)){var n=PPx.Extract("%*ppxlist(-"+t+")").slice(0,-1).split(",");return n.sort((function(e,t){return e.toLowerCase()<t.toLowerCase()?-1:1})),"0"!==e&&n.push(a.PPE),n}},buildFileName=function(e,t){return PPx.Extract("%*extract("+e+',"'+t+'")').slice(-30)},addSeparator=function(e,t){var r=e.length;return t&&r>0&&e.splice(0,0,a.SEP),t||r>0},focusPPb=function(e,t,r){if(t&&r&&e==="B_"+t){if("wt"===r)return[r,"*focus #%*findwindowclass(cascadia_hosting_window_class)"];if("wezterm"===r)return[r,"*execute B"+t+',printf "\\033]1337;SetUserVar=focus=UFBC\\007"']}return["console","*focus "+e]},createMenu=function(e,t,r,n,i){for(var c={ppc:[],ppv:[],ppb:[],ppcust:[],ppe:[]},o=[],p=o[0],u=o[1],s=o[2],l=0;l<e;l++)if(s=(p=t[l]).substring(0,2),u=p.slice(-1),"C_"===s)c.ppc.push("PPc:&"+u+"\\t"+buildFileName(p,"%%FD")+" = *focus "+p);else if("V_"===s)c.ppv.push("PPv:&"+u+"\\t"+buildFileName(p,"%%FC")+" = *focus "+p);else if("B_"===s){var f=focusPPb(p,n,i),P=f[0],x=f[1];c.ppb.push("PPb:&"+u+"\\t<"+P+"> = "+x)}else if("cs"===s){var d=PPx.Extract('%*findwindowtitle("PPx Customizer")');c.ppcust.push("PPcust:&"+u+"\\t<customizer> = *focus #"+d)}else"PP"===s&&c.ppe.push("PPe:&@\\t<editor>= *focus #"+r);var v=addSeparator(c.ppv,0!==c.ppc.length);return v=addSeparator(c.ppb,v),v=addSeparator(c.ppcust,v),v=addSeparator(c.ppe,v),[a.MENU+"\t= {"].concat(c.ppc,c.ppv,c.ppb,c.ppcust,c.ppe,["}"])};main();
