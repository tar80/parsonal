var e,t,r,n;Array.prototype.indexOf||(Array.prototype.indexOf=function(e,t){var r;if(null==this)throw new TypeError('Array.indexOf: "this" is null or not defined');var n=Object(this),i=n.length>>>0;if(0===i)return-1;var p=null!=t?t:0;if(Math.abs(p)===Infinity&&(p=0),p>=i)return-1;for(r=Math.max(p>=0?p:i-Math.abs(p),0);r<i;){if(r in n&&n[r]===e)return r;r++}return-1}),Object.keys||(Object.keys=(e=Object.prototype.hasOwnProperty,t=!{toString:null}.propertyIsEnumerable("toString"),n=(r=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"]).length,function(i){if("function"!=typeof i&&("object"!=typeof i||null==i))throw new TypeError("Object.keys: called on non-object");var p,c,u=[];for(p in i)e.call(i,p)&&u.push(p);if(t)for(c=0;c<n;c++)e.call(i,r[c])&&u.push(r[c]);return u}));var i={ppmName:"ppx-plugin-manager",ppmVersion:.95,language:"ja",encode:"utf16le",nlcode:"\r\n",nltype:"crlf",ppmID:"P",ppmSubID:"Q"},tmp=function(){var e=PPx.Extract('%*extract(C,"%%*temp()")');return{dir:e,file:e+"_ppmtemp",lf:e+"_temp.xlf",stdout:e+"_stdout",stderr:e+"_stderr",ppmDir:function(){var e=PPx.Extract("%'temp'%\\ppm");return PPx.Execute("*makedir "+e),e}}},isEmptyStr=function(e){return""===e},p=PPx.CreateObject("Scripting.FileSystemObject"),isCV8=function(){return"ClearScriptV8"===PPx.ScriptEngineName},windowID=function(){var e=PPx.Extract("%n"),t=e.replace(/^(C)([^_]+)$/,"$1_$2");return{id:e,uid:t}},c={TypeToCode:{crlf:"\r\n",cr:"\r",lf:"\n"},CodeToType:{"\r\n":"crlf","\r":"cr","\n":"lf"},Ppx:{lf:"%%bl",cr:"%%br",crlf:"%%bn",unix:"%%bl",mac:"%%br",dos:"%%bn","\n":"%%bl","\r":"%%br","\r\n":"%%bn"},Ascii:{lf:"10",cr:"13",crlf:"-1",unix:"10",mac:"13",dos:"-1","\n":"10","\r":"13","\r\n":"-1"}},exec=function(e,t){try{var r;return[!1,null!=(r=t())?r:""]}catch(n){return[!0,""]}finally{e.Close()}},writeLines=function(e){var t=e.path,r=e.data,n=e.enc,u=void 0===n?"utf8":n,a=e.append,o=void 0!==a&&a,l=e.overwrite,s=void 0!==l&&l,P=e.linefeed,f=void 0===P?i.nlcode:P;if(!s&&!o&&p.FileExists(t))return[!0,t+" already exists"];var x,d=p.GetParentFolderName(t);if(p.FolderExists(d)||PPx.Execute("*makedir "+d),"utf8"===u){if(isCV8()){var v=r.join(f),E=o?"AppendAllText":"WriteAllText";return[!1,NETAPI.System.IO.File[E](t,v)]}var m=s||o?2:1,b=PPx.CreateObject("ADODB.Stream");x=exec(b,(function(){b.Open(),b.Charset="UTF-8",b.LineSeparator=Number(c.Ascii[f]),o?(b.LoadFromFile(t),b.Position=b.Size,b.SetEOS):b.Position=0,b.WriteText(r.join(f),1),b.SaveToFile(t,m)}))[0]}else{var h=o?8:s?2:1;p.FileExists(t)||PPx.Execute("%Osq *makefile "+t);var y="utf16le"===u?-1:0,O=p.GetFile(t).OpenAsTextStream(h,y);x=exec(O,(function(){O.Write(r.join(f)+f)}))[0]}return x?[!0,"Could not write to "+t]:[!1,""]},pathSelf=function(){var e,t,r=PPx.ScriptName;return~r.indexOf("\\")?(e=r.replace(/^.*\\/,""),t=PPx.Extract("%*name(DKN,"+r+")")):(e=r,t=PPx.Extract("%FDN")),{scriptName:e,parentDir:t.replace(/\\$/,"")}},validArgs=function(){for(var e=[],t=PPx.Arguments;!t.atEnd();t.moveNext())e.push(t.value);return e},safeArgs=function(){for(var e=[],t=validArgs(),r=0,n=arguments.length;r<n;r++)e.push(_valueConverter(r<0||arguments.length<=r?undefined:arguments[r],t[r]));return e},_valueConverter=function(e,t){if(null==t||""===t)return null!=e?e:undefined;switch(typeof e){case"number":var r=Number(t);return isNaN(r)?e:r;case"boolean":return"false"!==t&&"0"!==t&&null!=t;default:return t}},u={MENU:"M_temp",PPE:"PPe",PPE_CLASS:"PPeditW",SEP:"-- ="},a=windowID().uid,main=function(){var e=PPx.Extract("%*findwindowclass("+u.PPE_CLASS+")"),t=sortPPxID(e),r=pathSelf().scriptName;t||(PPx.Echo(r+": 引数が不正"),PPx.Quit(-1)),~t.indexOf(a)&&t.splice(t.indexOf(a),1);var n=t.length;if(1===n)PPx.Execute("*selectppx "+t[0]);else if(n>1){var p=tmp().file,c=writeLines({path:p,data:createMenu(n,t,e),enc:"utf16le",linefeed:i.nlcode,overwrite:!0}),o=c[0],l=c[1];o&&(PPx.Echo(r+": "+l),PPx.Quit(-1)),PPx.Execute("*setcust @"+p),PPx.Execute('%k"@down"%:*focus %'+u.MENU),PPx.Execute('*deletecust "'+u.MENU+'"'),PPx.Execute('%K"@LOADCUST"')}},sortPPxID=function(e){var t=safeArgs("")[0],r=/^[BCV#]#?$/;if(isEmptyStr(t)||r.test(t)){var n=PPx.Extract("%*ppxlist(-"+t+")").slice(0,-1).split(",");return n.sort((function(e,t){return e.toLowerCase()<t.toLowerCase()?-1:1})),"0"!==e&&n.push(u.PPE),n}},buildFileName=function(e,t){return PPx.Extract("%*extract("+e+',"'+t+'")').slice(-30).replace(/\\t/g,"\\\\t")},addSeparator=function(e,t){var r=e.length;return t&&r>0&&e.splice(0,0,u.SEP),t||r>0},createMenu=function(e,t,r){for(var n={ppc:[],ppv:[],ppb:[],ppcust:[],ppe:[]},i=[],p=i[0],c=i[1],a=i[2],o=0;o<e;o++)if(a=(p=t[o]).substring(0,2),c=p.slice(-1),"C_"===a)n.ppc.push("PPc:&"+c+" "+buildFileName(p,"%%FD")+" = "+p);else if("V_"===a)n.ppv.push("PPv:&"+c+" "+buildFileName(p,"%%FC")+" = "+p);else if("B_"===a)n.ppb.push("PPb:&"+c+" "+buildFileName(p,"%%FD")+" = "+p);else if("cs"===a){var l=PPx.Extract('%*findwindowtitle("PPx Customizer")');n.ppcust.push("PPcust:&"+c+" = #"+l)}else"PP"===a&&n.ppe.push("PPe:&@ = #"+r);var s=addSeparator(n.ppv,0!==n.ppc.length);return s=addSeparator(n.ppb,s),s=addSeparator(n.ppcust,s),s=addSeparator(n.ppe,s),[u.MENU+"\t= {"].concat(n.ppc,n.ppv,n.ppb,n.ppcust,n.ppe,["}"])};main();
